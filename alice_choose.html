<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Alice in Wonderland: Choose Your Own Adventure</title>
  <style>
    /* Overall page styling */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Georgia', serif;
      background: url('https://i.imgur.com/gaZ9Vggg.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #333;
    }
    /* Centered container with a professional look */
    .container {
      background-color: rgba(255, 255, 255, 0.9);
      margin: 50px auto;
      padding: 30px;
      max-width: 800px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }
    h1 {
      text-align: center;
      font-size: 2.5em;
      margin-bottom: 20px;
    }
    #prompt {
      font-size: 1.2em;
      line-height: 1.6;
      margin: 20px 0;
      text-align: justify;
    }
    .choices {
      display: flex;
      justify-content: space-around;
      margin-top: 30px;
    }
    .choice-button {
      background-color: #6a5acd;
      border: none;
      padding: 15px 30px;
      font-size: 1em;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .choice-button:hover {
      background-color: #483d8b;
    }
    #loading {
      text-align: center;
      font-size: 1em;
      color: #555;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Alice in Wonderland: Choose Your Own Adventure</h1>
    <div id="story">
      <div id="prompt">Loading adventure...</div>
      <div class="choices">
        <button class="choice-button" id="choice1" disabled>Choice 1</button>
        <button class="choice-button" id="choice2" disabled>Choice 2</button>
      </div>
      <div id="loading"></div>
    </div>
  </div>

  <script>
    // IMPORTANT: Replace 'YOUR_API_KEY_HERE' with your actual OpenAI API key.
    // In a production environment, NEVER expose your API key on the client side.
    const OPENAI_API_KEY = '';

    // Conversation history for ChatGPT
    let conversation = [
      {
        role: "system",
        content: "You are ChatGPT, a creative writing assistant that generates interactive, Alice in Wonderland choose-your-own-adventure stories. For every step, produce a JSON object with two keys: 'prompt' and 'choices'. The 'prompt' should be a narrative segment describing the current scene in an Alice in Wonderland style, and the 'choices' should be an array of exactly two distinct options for what the user might do next. Format your entire output as valid JSON."
      },
      {
        role: "user",
        content: "Start the adventure."
      }
    ];

    // Get references to DOM elements
    const promptEl = document.getElementById('prompt');
    const choice1Btn = document.getElementById('choice1');
    const choice2Btn = document.getElementById('choice2');
    const loadingEl = document.getElementById('loading');

    // Function to call ChatGPT and update the story
    async function fetchAdventure() {
      loadingEl.textContent = "Generating next adventure...";
      // Disable buttons while waiting
      choice1Btn.disabled = true;
      choice2Btn.disabled = true;

      try {
        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: conversation,
            temperature: 0.9,
            max_tokens: 300
          })
        });

        const data = await response.json();
        // Extract and trim the assistant's reply
        const messageContent = data.choices[0].message.content.trim();
        let adventureData;
        try {
          // Parse the JSON output generated by ChatGPT
          adventureData = JSON.parse(messageContent);
        } catch (e) {
          console.error("Error parsing JSON:", e);
          promptEl.textContent = "Oops, something went wrong with the story generation.";
          loadingEl.textContent = "";
          return;
        }

        // Update the page with the new prompt and choices
        promptEl.textContent = adventureData.prompt;
        choice1Btn.textContent = adventureData.choices[0];
        choice2Btn.textContent = adventureData.choices[1];

        // Re-enable choice buttons
        choice1Btn.disabled = false;
        choice2Btn.disabled = false;
        loadingEl.textContent = "";
      } catch (error) {
        console.error("Error fetching adventure:", error);
        promptEl.textContent = "Error generating the adventure. Please try again later.";
        loadingEl.textContent = "";
      }
    }

    // Function to handle when the user selects a choice
    function handleChoice(choiceText) {
      // Add the user's choice to the conversation history
      conversation.push({
        role: "user",
        content: "I choose: " + choiceText
      });
      // Fetch and display the next segment of the adventure
      fetchAdventure();
    }

    // Event listeners for the choice buttons
    choice1Btn.addEventListener('click', () => {
      handleChoice(choice1Btn.textContent);
    });
    choice2Btn.addEventListener('click', () => {
      handleChoice(choice2Btn.textContent);
    });

    // Start the adventure when the page loads
    fetchAdventure();
  </script>
</body>
</html>
